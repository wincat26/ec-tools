<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»å•†ç‹è€…ä¹‹è·¯ - å¾æˆ°å„€è¡¨æ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap');
        
        :root {
            --king-gold: #fbbf24;
            --king-red: #dc2626;
            --king-purple: #7c3aed;
            --king-blue: #2563eb;
            --king-green: #059669;
        }
        
        body { 
            font-family: 'Inter', 'Noto Sans TC', sans-serif; 
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e40af 100%);
            min-height: 100vh;
        }
        
        .king-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .hero-crown {
            background: linear-gradient(135deg, var(--king-gold), #f59e0b);
            border-radius: 24px;
            color: white;
            padding: 3rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .hero-crown::before {
            content: 'ğŸ‘‘';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 8rem;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(15deg); }
        }
        
        .level-crown {
            background: linear-gradient(135deg, var(--king-gold), var(--king-red));
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: 800;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 10px 25px rgba(251, 191, 36, 0.3);
        }
        
        .import-option {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            border: 2px solid #f1f5f9;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .import-option:hover {
            border-color: var(--king-blue);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.15);
        }
        
        .import-option.selected {
            border-color: var(--king-blue);
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
        }
        
        .king-button {
            background: linear-gradient(135deg, var(--king-blue), var(--king-purple));
            color: white;
            padding: 1rem 2rem;
            border-radius: 16px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .king-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(37, 99, 235, 0.3);
        }
        
        .king-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body class="p-4">
    <div class="max-w-7xl mx-auto">
        <!-- ç‹è€…é ­éƒ¨å€åŸŸ -->
        <div class="hero-crown">
            <div class="relative z-10">
                <div class="level-crown mb-6">
                    <span>ğŸ‘¶</span>
                    <span>æ–°æ‰‹å•†äºº Lv.1</span>
                </div>
                <h1 class="text-5xl font-black mb-4">é›»å•†ç‹è€…ä¹‹è·¯</h1>
                <p class="text-2xl opacity-90 mb-8">é–‹å§‹æ‚¨çš„å¾æˆ°æ—…ç¨‹ï¼Œç™»ä¸Šé›»å•†ç‹åº§ï¼</p>
            </div>
        </div>
        
        <!-- æ•¸æ“šåŒ¯å…¥é¸é … -->
        <div class="king-card p-8 mb-6">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">ğŸ¯ ç¬¬ä¸€æ­¥ï¼šåŒ¯å…¥æ‚¨çš„æˆ°åŠ›æ•¸æ“š</h2>
            <p class="text-lg text-gray-600 mb-8">äº†è§£ç¾æ³ï¼Œåˆ¶å®šå¾æˆ°ç­–ç•¥</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="import-option" onclick="selectImportMethod('csv')">
                    <div class="text-4xl mb-4">ğŸ“</div>
                    <h3 class="text-xl font-bold mb-2">ä¸Šå‚³ CSV æª”æ¡ˆ</h3>
                    <p class="text-sm text-gray-600 mb-4">æœ€ç°¡å–®çš„æ–¹å¼ï¼Œç«‹å³é–‹å§‹åˆ†æ</p>
                    <div class="text-xs text-gray-500">
                        æ”¯æ´æ ¼å¼ï¼šæ—¥æœŸ,ç‡Ÿæ”¶,æµé‡,è½‰æ›ç‡,å®¢å–®åƒ¹
                    </div>
                </div>
                
                <div class="import-option" onclick="selectImportMethod('datalake')">
                    <div class="text-4xl mb-4">ğŸ—ï¸</div>
                    <h3 class="text-xl font-bold mb-2">é€£æ¥ DataLake</h3>
                    <p class="text-sm text-gray-600 mb-4">BigQuery æ•¸æ“šæ¹–è‡ªå‹•åŒæ­¥</p>
                    <div class="text-xs text-gray-500">
                        ä¼æ¥­ç´šæ•¸æ“šæ•´åˆ
                    </div>
                </div>
                
                <div class="import-option" onclick="selectImportMethod('ga')">
                    <div class="text-4xl mb-4">ğŸ“ˆ</div>
                    <h3 class="text-xl font-bold mb-2">Google Analytics</h3>
                    <p class="text-sm text-gray-600 mb-4">é€£æ¥ GA4 ç²å–æµé‡æ•¸æ“š</p>
                    <div class="text-xs text-gray-500">
                        å°ˆæ¥­æ•¸æ“šåˆ†æ
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½å±•ç¤ºå€åŸŸ -->
        <div id="feature-display-area" class="hidden mb-6">
            <!-- CSV ä¸Šå‚³åŠŸèƒ½å€ -->
            <div id="csv-feature" class="hidden">
                <div class="king-card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ CSV æª”æ¡ˆä¸Šå‚³</h3>
                    <div class="border-2 border-dashed border-blue-300 rounded-lg p-8 text-center bg-blue-50 hover:bg-blue-100 transition-colors cursor-pointer" onclick="document.getElementById('csv-file').click()">
                        <i class="fas fa-cloud-upload-alt text-4xl text-blue-500 mb-4"></i>
                        <p class="text-lg font-medium text-blue-700 mb-2">é»æ“Šä¸Šå‚³æˆ–æ‹–æ‹½æª”æ¡ˆåˆ°æ­¤è™•</p>
                        <p class="text-sm text-blue-500 mb-4">æ”¯æ´ .csv æ ¼å¼ï¼Œæœ€å¤§ 10MB</p>
                        <div class="text-xs text-gray-500">
                            æª”æ¡ˆæ ¼å¼ï¼šæ—¥æœŸ,ç‡Ÿæ”¶,æµé‡,è½‰æ›ç‡,å®¢å–®åƒ¹<br>
                            ç¯„ä¾‹ï¼š2024-01-01,450000,12500,2.3,1580
                        </div>
                    </div>
                    <input type="file" id="csv-file" class="hidden" accept=".csv" onchange="handleFileUpload(event)">
                </div>
            </div>
            
            <!-- DataLake é–‹ç™¼ä¸­ -->
            <div id="datalake-feature" class="hidden">
                <div class="king-card p-8 text-center">
                    <div class="text-6xl mb-4">ğŸš§</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">DataLake é€£æ¥åŠŸèƒ½</h3>
                    <p class="text-lg text-gray-600 mb-6">é–‹ç™¼ä¸­ï¼Œè«‹è€å¿ƒç­‰å€™</p>
                    <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-4 rounded-xl">
                        <p class="text-sm text-orange-700">ğŸ’¡ æ­¤åŠŸèƒ½å°‡æ”¯æ´ BigQueryã€Snowflake ç­‰ä¼æ¥­ç´šæ•¸æ“šæ¹–é€£æ¥</p>
                    </div>
                </div>
            </div>
            
            <!-- GA é–‹ç™¼ä¸­ -->
            <div id="ga-feature" class="hidden">
                <div class="king-card p-8 text-center">
                    <div class="text-6xl mb-4">ğŸš§</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Google Analytics é€£æ¥</h3>
                    <p class="text-lg text-gray-600 mb-6">é–‹ç™¼ä¸­ï¼Œè«‹è€å¿ƒç­‰å€™</p>
                    <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-4 rounded-xl">
                        <p class="text-sm text-orange-700">ğŸ’¡ æ­¤åŠŸèƒ½å°‡æ”¯æ´ GA4 API è‡ªå‹•åŒæ­¥æµé‡èˆ‡è½‰æ›æ•¸æ“š</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ•¸æ“šé è¦½å€åŸŸ -->
        <div id="data-preview-area" class="hidden mb-6">
            <div class="king-card p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-800">ğŸ“Š æ•¸æ“šé è¦½</h3>
                    <button onclick="removeFile()" class="text-red-500 hover:text-red-700 text-sm">
                        <i class="fas fa-times mr-1"></i>ç§»é™¤æª”æ¡ˆ
                    </button>
                </div>
                <div class="mb-4">
                    <span class="text-sm font-medium text-gray-700" id="file-name"></span>
                    <span class="text-xs text-gray-500 ml-2" id="file-info"></span>
                </div>
                <div id="data-preview-table" class="overflow-x-auto mb-6"></div>
                <div class="text-center">
                    <button onclick="analyzeData()" class="king-button">
                        <i class="fas fa-chart-line mr-2"></i>
                        åˆ†ææ•¸æ“š
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æ•¸æ“šæ‘˜è¦åˆ†æ -->
        <div id="data-summary-area" class="hidden mb-6">
            <div class="king-card p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6">ğŸ“ˆ ç‡Ÿé‹æ•¸æ“šæ‘˜è¦</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="text-center p-4 bg-blue-50 rounded-xl">
                        <div class="text-2xl font-bold text-blue-600" id="avg-sessions">-</div>
                        <div class="text-sm text-gray-600">æ—¥å‡æµé‡</div>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-xl">
                        <div class="text-2xl font-bold text-green-600" id="avg-orders">-</div>
                        <div class="text-sm text-gray-600">æ—¥å‡è¨‚å–®æ•¸</div>
                    </div>
                    <div class="text-center p-4 bg-orange-50 rounded-xl">
                        <div class="text-2xl font-bold text-orange-600" id="avg-aov">-</div>
                        <div class="text-sm text-gray-600">å¹³å‡è¨‚å–®é‡‘é¡</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-xl">
                        <div class="text-2xl font-bold text-purple-600" id="avg-cvr">-</div>
                        <div class="text-sm text-gray-600">å¹³å‡è½‰æ›ç‡</div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-4 rounded-xl mb-6">
                    <h4 class="font-bold text-gray-800 mb-2">ğŸ’¡ æ•¸æ“šæ´å¯Ÿ</h4>
                    <p id="data-insights" class="text-sm text-gray-700">-</p>
                </div>
                <div class="text-center">
                    <button onclick="proceedToGoalSetting()" class="king-button">
                        <i class="fas fa-target mr-2"></i>
                        è¨­å®šå¾æˆ°ç›®æ¨™
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let uploadedData = null;
        let selectedMethod = null;

        function selectImportMethod(method) {
            // é‡ç½®æ‰€æœ‰é¸é …
            document.querySelectorAll('.import-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // éš±è—æ‰€æœ‰åŠŸèƒ½å€
            document.querySelectorAll('#feature-display-area > div').forEach(feature => {
                feature.classList.add('hidden');
            });
            
            // é¸ä¸­ç•¶å‰é¸é …
            event.currentTarget.classList.add('selected');
            selectedMethod = method;
            
            // é¡¯ç¤ºå°æ‡‰åŠŸèƒ½å€
            document.getElementById('feature-display-area').classList.remove('hidden');
            document.getElementById(`${method}-feature`).classList.remove('hidden');
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 10 * 1024 * 1024) {
                alert('æª”æ¡ˆå¤§å°ä¸èƒ½è¶…é 10MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const data = parseCSV(csv);
                    displayDataPreview(file, data);
                    uploadedData = data;
                } catch (error) {
                    alert('CSV æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆæ ¼å¼');
                }
            };
            reader.readAsText(file);
        }

        function parseCSV(csv) {
            const lines = csv.split('\n').filter(line => line.trim());
            const data = [];
            
            // å¯¦éš›æ¬„ä½é †åºï¼šæ—¥æœŸ,ç¸½ç‡Ÿæ¥­é¡,äº¤æ˜“æœƒå“¡æ•¸,ç¸½è¨‚å–®é‡,æˆäº¤è¨‚å–®å‡åƒ¹,ç¶²è·¯æ–°æœƒå“¡æ•¸,å·¥ä½œéšæ®µ,è½‰æ›ç‡
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                if (values.length >= 7) {
                    data.push({
                        date: values[0],                    // æ—¥æœŸ
                        revenue: parseFloat(values[1]) || 0, // ç¸½ç‡Ÿæ¥­é¡
                        members: parseFloat(values[2]) || 0, // äº¤æ˜“æœƒå“¡æ•¸
                        orders: parseFloat(values[3]) || 0,  // ç¸½è¨‚å–®é‡
                        aov: parseFloat(values[4]) || 0,     // æˆäº¤è¨‚å–®å‡åƒ¹
                        newMembers: parseFloat(values[5]) || 0, // ç¶²è·¯æ–°æœƒå“¡æ•¸
                        traffic: parseFloat(values[6]) || 0, // å·¥ä½œéšæ®µ
                        cvr: parseFloat(values[7]) || 0      // è½‰æ›ç‡
                    });
                }
            }
            return data;
        }

        function displayDataPreview(file, data) {
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-info').textContent = `${data.length} ç­†è³‡æ–™ï¼Œæª”æ¡ˆå¤§å°ï¼š${(file.size/1024).toFixed(1)} KB`;
            
            const preview = data.slice(0, 5);
            const table = `
                <table class="min-w-full text-sm border border-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-2 py-2 border text-xs">æ—¥æœŸ</th>
                            <th class="px-2 py-2 border text-xs">ç¸½ç‡Ÿæ¥­é¡</th>
                            <th class="px-2 py-2 border text-xs">äº¤æ˜“æœƒå“¡</th>
                            <th class="px-2 py-2 border text-xs">ç¸½è¨‚å–®é‡</th>
                            <th class="px-2 py-2 border text-xs">è¨‚å–®å‡åƒ¹</th>
                            <th class="px-2 py-2 border text-xs">æ–°æœƒå“¡</th>
                            <th class="px-2 py-2 border text-xs">å·¥ä½œéšæ®µ</th>
                            <th class="px-2 py-2 border text-xs">è½‰æ›ç‡</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${preview.map(row => `
                            <tr class="border-t">
                                <td class="px-2 py-2 border text-xs">${row.date}</td>
                                <td class="px-2 py-2 border text-xs">$${row.revenue.toLocaleString()}</td>
                                <td class="px-2 py-2 border text-xs">${row.members}</td>
                                <td class="px-2 py-2 border text-xs">${row.orders}</td>
                                <td class="px-2 py-2 border text-xs">$${row.aov.toLocaleString()}</td>
                                <td class="px-2 py-2 border text-xs">${row.newMembers}</td>
                                <td class="px-2 py-2 border text-xs">${row.traffic.toLocaleString()}</td>
                                <td class="px-2 py-2 border text-xs">${row.cvr}%</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                ${data.length > 5 ? `<p class="text-xs text-gray-500 mt-2">é¡¯ç¤ºå‰ 5 ç­†ï¼Œå…± ${data.length} ç­†è³‡æ–™</p>` : ''}
            `;
            
            document.getElementById('data-preview-table').innerHTML = table;
            document.getElementById('data-preview-area').classList.remove('hidden');
        }

        function removeFile() {
            document.getElementById('csv-file').value = '';
            document.getElementById('data-preview-area').classList.add('hidden');
            document.getElementById('data-summary-area').classList.add('hidden');
            uploadedData = null;
        }

        function analyzeData() {
            if (!uploadedData || uploadedData.length === 0) return;
            
            const button = event.target;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>åˆ†æä¸­...';
            button.disabled = true;
            
            setTimeout(() => {
                const summary = calculateSummary(uploadedData);
                displaySummary(summary);
                button.innerHTML = '<i class="fas fa-chart-line mr-2"></i>åˆ†ææ•¸æ“š';
                button.disabled = false;
            }, 1500);
        }

        function calculateSummary(data) {
            const validData = data.filter(d => d.revenue > 0);
            
            const avgSessions = validData.reduce((sum, d) => sum + d.traffic, 0) / validData.length;
            const avgRevenue = validData.reduce((sum, d) => sum + d.revenue, 0) / validData.length;
            const avgCvr = validData.reduce((sum, d) => sum + d.cvr, 0) / validData.length;
            const avgAov = validData.reduce((sum, d) => sum + d.aov, 0) / validData.length;
            const avgOrders = validData.reduce((sum, d) => sum + d.orders, 0) / validData.length;
            
            return {
                avgSessions: Math.round(avgSessions),
                avgOrders: Math.round(avgOrders),
                avgAov: Math.round(avgAov),
                avgCvr: avgCvr.toFixed(2),
                totalDays: validData.length,
                totalRevenue: validData.reduce((sum, d) => sum + d.revenue, 0)
            };
        }

        function displaySummary(summary) {
            document.getElementById('avg-sessions').textContent = summary.avgSessions.toLocaleString();
            document.getElementById('avg-orders').textContent = summary.avgOrders.toLocaleString();
            document.getElementById('avg-aov').textContent = `$${summary.avgAov.toLocaleString()}`;
            document.getElementById('avg-cvr').textContent = `${summary.avgCvr}%`;
            
            let insights = `æ ¹æ“š ${summary.totalDays} å¤©çš„æ•¸æ“šåˆ†æï¼Œæ‚¨çš„é›»å•†è¡¨ç¾`;
            if (summary.avgCvr > 3) {
                insights += "è½‰æ›ç‡è¡¨ç¾å„ªç§€ï¼Œå»ºè­°é‡é»æå‡æµé‡ç²å–ã€‚";
            } else if (summary.avgCvr < 1.5) {
                insights += "è½‰æ›ç‡æœ‰æå‡ç©ºé–“ï¼Œå»ºè­°å„ªåŒ–å•†å“é é¢å’Œçµå¸³æµç¨‹ã€‚";
            } else {
                insights += "å„é …æŒ‡æ¨™è¡¨ç¾ç©©å®šï¼Œå¯è€ƒæ…®åŒæ­¥æå‡æµé‡å’Œè½‰æ›ç‡ã€‚";
            }
            
            document.getElementById('data-insights').textContent = insights;
            document.getElementById('data-summary-area').classList.remove('hidden');
        }

        function proceedToGoalSetting() {
            alert('å³å°‡é€²å…¥ç›®æ¨™è¨­å®šé é¢...');
            // é€™è£¡å¯ä»¥è·³è½‰åˆ°ç›®æ¨™è¨­å®šé é¢
        }
    </script>
</body>
</html>