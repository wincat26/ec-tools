# Google Chat 模板整理總結

**版本**：v1.1  
**更新日期**：2025-01-27

---

## ✅ 已整合的核心概念

### 1. 營收公式拆解

**公式**：`總營收 = Sessions × CVR × AOV`

**在模板中的呈現**：
- 獨立區塊「🔍 營收公式拆解」
- 顯示三個組成要素：
  - 流量 (Sessions)：當日值 + vs. 上週同期變化
  - 轉換率 (CVR)：當日值 + vs. 上週同期變化
  - 客單價 (AOV)：當日值 + vs. 上週同期變化

**價值**：
- 讓使用者清楚了解營收變化的來源
- 快速識別哪個要素提升了/下降了
- 形成數據驅動的決策基礎

---

### 2. 趨勢分析

**包含的分析維度**：

1. **週變化分析（Week-over-Week）**
   - 總營收 vs. 上週同期
   - Sessions vs. 上週同期
   - CVR vs. 上週同期
   - AOV vs. 上週同期

2. **目標達成分析**
   - 目標達成率（顏色指標）
   - 月迄今營收
   - 預估當月營收
   - 距離目標還差多少
   - 每日平均需達成金額（以達成當月目標）

**價值**：
- 提供時間維度的比較基準
- 幫助判斷營運是否在正確軌道上
- 量化目標達成進度

---

## 📊 模板結構（最終版）

```
📊 每日數據彙整日報
日期：YYYY-MM-DD

┌─ 📈 當日關鍵指標
│  └─ 總營收：$XX,XXX 📈 +15.2%
│
├─ 🔍 營收公式拆解
│  ├─ 流量 (Sessions)：X,XXX 📈 +8.5%
│  ├─ 轉換率 (CVR)：X.XX% 📉 -2.0%
│  └─ 客單價 (AOV)：$X,XXX 📈 +5.0%
│
├─ 📦 訂單資訊
│  └─ 訂單數：XX 筆（平均客單價 $X,XXX）
│
├─ 💰 廣告表現
│  ├─ 廣告花費：$X 萬
│  └─ ROAS：X.XXx
│
├─ 🎯 當月目標達成
│  ├─ 目標達成率：XX.X%（顏色指標）
│  ├─ 月迄今營收：$XX 萬
│  ├─ 預估當月營收：$XX 萬
│  ├─ 當月目標：$XX 萬
│  └─ 每日平均需達成：$X,XXX（以達成當月目標）
│
├─ 💡 關鍵洞察
│  └─ 數據彙整完成，點擊下方按鈕深入分析營運狀況
│
└─ 📊 深入分析 [按鈕]
```

---

## 🎨 視覺設計規範

### 顏色系統

| 狀態 | 顏色 | 使用場景 |
|------|------|---------|
| 優秀 | `#51CF66` (綠色) | 達成率 ≥80%、ROAS ≥3.0、上升趨勢 |
| 良好 | `#FFD93D` (黃色) | 達成率 50-80%、ROAS 2.0-3.0 |
| 需注意 | `#FF6B6B` (紅色) | 達成率 <50%、ROAS <2.0、下降趨勢 |

### 圖示系統

| 趨勢 | 圖示 | 判斷標準 |
|------|------|---------|
| 上升 | 📈 | 變化 > 5% |
| 下降 | 📉 | 變化 < -5% |
| 持平 | ➡️ | -5% ≤ 變化 ≤ 5% |

### 數字格式化

- **貨幣**：≥10,000 顯示為「X.X 萬」，<10,000 顯示為「$X,XXX」
- **百分比**：保留 2 位小數，正數顯示「+」號
- **整數**：使用千分位符號

---

## 🔄 數據流程

### 資料生成流程

```
1. 查詢當日指標（營收、訂單、AOV）
   ↓
2. 查詢 GA4 Sessions
   ↓
3. 查詢上週同期資料（Sessions、AOV）
   ↓
4. 計算週變化（Sessions、AOV、CVR、Revenue）
   ↓
5. 計算月迄今指標（MTD 營收、達成率、預估營收）
   ↓
6. 生成單行 JSON 資料
   ↓
7. 套入 Google Chat 卡片模板
   ↓
8. 發送推播
```

---

## 📝 實作細節

### 新增的數據欄位

在 `daily_aggregation.py` 中新增：
- `sessions_change_wow`：Sessions 週變化
- `aov_change_wow`：AOV 週變化

### 新增的計算函數

在 `google_chat.py` 中新增：
- `_calculate_sessions_change_wow()`：計算 Sessions 週變化
- `_calculate_aov_change_wow()`：計算 AOV 週變化
- `_calculate_daily_target_needed()`：計算每日平均需達成金額
- `_get_sessions_icon()`：取得 Sessions 趨勢圖示
- `_get_aov_icon()`：取得 AOV 趨勢圖示

---

## 🎯 模板優點

1. **結構清晰**：分區塊顯示，易於閱讀
2. **營收公式拆解**：清楚呈現營收的三個組成要素
3. **趨勢分析**：提供週變化比較和目標達成分析
4. **視覺化**：使用顏色和圖示快速識別狀態
5. **行動導向**：提供「深入分析」按鈕連結到儀表板

---

## 📚 相關文檔

- [Google Chat 模板設計文檔](./GOOGLE_CHAT_TEMPLATE.md)
- [PRD v1.1 需求文件](../../prd/)

---

**最後更新**：2025-01-27

