# è³‡æ–™å­˜å„²èˆ‡æ’ç¨‹è¨­å®šç¸½çµ

**å»ºç«‹æ—¥æœŸ**ï¼š2025-01-27

---

## ğŸ“Š è³‡æ–™å­˜å„²ä½ç½®

### Google Cloud å°ˆæ¡ˆ
- **å°ˆæ¡ˆ ID**ï¼š`datalake360-saintpaul`
- **ä½ç½®**ï¼š`asia-east1`ï¼ˆå°ç£ï¼‰

### ä¸»è¦è³‡æ–™é›†

| è³‡æ–™é›† | è¡¨æ•¸é‡ | ç”¨é€” |
|--------|--------|------|
| `datalake_stpl` | 24 å€‹è¡¨ | E-com è¨‚å–®å’Œå•†å“è³‡æ–™ |
| `analytics_304437305` | 1,421 å€‹è¡¨ | GA4 äº‹ä»¶è³‡æ–™ï¼ˆæ—¥æœŸåˆ†å€è¡¨ï¼‰ |
| `cdp_data` | 10 å€‹è¡¨ | CDP ç›¸é—œè³‡æ–™ |
| `saintpaul_data` | 10 å€‹è¡¨ | å…¶ä»–è³‡æ–™ |
| `datalake_temp_stpl` | 56 å€‹è¡¨ | è‡¨æ™‚è³‡æ–™ |

### ç³»çµ±ä½¿ç”¨çš„è³‡æ–™è¡¨

#### 1. E-com è¨‚å–®è³‡æ–™
- **è³‡æ–™é›†**ï¼š`datalake_stpl`
- **è³‡æ–™è¡¨**ï¼š`lv1_order_master`
- **ç”¨é€”**ï¼šæŸ¥è©¢ç‡Ÿæ”¶ã€è¨‚å–®æ•¸ã€AOV
- **é—œéµæ¬„ä½**ï¼š
  - `dt`ï¼šè¨‚å–®æ—¥æœŸ
  - `ord_id`ï¼šè¨‚å–® ID
  - `ord_rev`ï¼šè¨‚å–®é‡‘é¡
  - `bhv1`ï¼šè¡Œç‚ºç‹€æ…‹ï¼ˆæ’é™¤ã€Œå–æ¶ˆã€ï¼‰
  - `touch_class`ï¼šé€šè·¯é¡åˆ¥ï¼ˆ`'ec'`ï¼‰

#### 2. GA4 äº‹ä»¶è³‡æ–™
- **è³‡æ–™é›†**ï¼š`analytics_304437305`
- **è³‡æ–™è¡¨**ï¼š`events_*`ï¼ˆæ—¥æœŸåˆ†å€è¡¨ï¼Œæ ¼å¼ï¼š`events_YYYYMMDD`ï¼‰
- **ç”¨é€”**ï¼šæŸ¥è©¢ Sessionsã€è½‰æ›äº‹ä»¶
- **é—œéµæ¬„ä½**ï¼š
  - `event_name`ï¼šäº‹ä»¶åç¨±ï¼ˆ`'session_start'`ã€`'purchase'`ï¼‰
  - `user_pseudo_id`ï¼šç”¨æˆ¶ ID
  - `event_params`ï¼šäº‹ä»¶åƒæ•¸ï¼ˆåŒ…å« `ga_session_id`ã€`transaction_id`ï¼‰

#### 3. å»£å‘Šè³‡æ–™ï¼ˆå¾…å»ºç«‹ï¼‰
- **ç•¶å‰ç‹€æ…‹**ï¼šä½¿ç”¨ `clients.yaml` æ‰‹å‹•è¼¸å…¥
- **æœªä¾†è¦åŠƒ**ï¼šä½¿ç”¨ MCP å¾ Meta Ads å’Œ Google Ads API è‡ªå‹•å–å¾—
- **å­˜å„²ä½ç½®**ï¼šå¾…æ±ºå®šï¼ˆå¯èƒ½å»ºç«‹æ–°çš„è³‡æ–™è¡¨æˆ–ä½¿ç”¨ç¾æœ‰è¡¨ï¼‰

---

## â° æ’ç¨‹è¨­å®š

### åŸ·è¡Œæ™‚é–“
- **æ¯å¤©æ—©ä¸Š 09:00** è‡ªå‹•åŸ·è¡Œ
- **å ±å‘Šæ—¥æœŸ**ï¼šæ˜¨æ—¥ï¼ˆT-1ï¼‰

### macOS è¨­å®šï¼ˆLaunchAgent - æ¨è–¦ï¼‰

#### å¿«é€Ÿè¨­å®š
```bash
cd demos/daily-report-mvp
./scripts/setup_launchagent.sh
```

#### è¨­å®šå…§å®¹
- **åŸ·è¡Œæ™‚é–“**ï¼šæ¯å¤©æ—©ä¸Š 09:00
- **è‡ªå‹•ä½¿ç”¨æ˜¨æ—¥æ—¥æœŸ**ï¼šç„¡éœ€æ‰‹å‹•æŒ‡å®šæ—¥æœŸ
- **æ—¥èªŒä½ç½®**ï¼š`logs/launchd.log` å’Œ `logs/launchd_error.log`

#### ç®¡ç†å‘½ä»¤
```bash
# æŸ¥çœ‹ç‹€æ…‹
launchctl list | grep daily-report

# ç«‹å³åŸ·è¡Œï¼ˆæ¸¬è©¦ç”¨ï¼‰
launchctl start com.daily-report

# å¸è¼‰æœå‹™
launchctl unload ~/Library/LaunchAgents/com.daily-report.plist
```

---

## ğŸ“‹ å»£å‘Šè³‡æ–™è™•ç†

### ç•¶å‰ç‹€æ…‹
- **è³‡æ–™ä¾†æº**ï¼šæ‰‹å‹•è¼¸å…¥åˆ° `clients.yaml`
- **é¡¯ç¤ºæ–¹å¼**ï¼šå¦‚æœæ²’æœ‰è³‡æ–™ï¼Œé¡¯ç¤º "N/Aï¼ˆè³‡æ–™å¾…åŒ¯å…¥ï¼‰"

### è¨­å®šæ ¼å¼
```yaml
ad_data:
  manual_ad_spend:
    "2025-11-04":
      meta_ads: 2199
      google_ads: 4587
```

### æœªä¾†è¦åŠƒ
- ä½¿ç”¨ MCP å¾ Meta Ads å’Œ Google Ads API è‡ªå‹•å–å¾—
- ç„¡éœ€æ‰‹å‹•è¼¸å…¥ï¼Œæ¯æ—¥è‡ªå‹•æ›´æ–°

---

## ğŸ” è³‡æ–™æŸ¥è©¢ä½ç½®

### ç¨‹å¼ç¢¼ä½ç½®
- **è³‡æ–™æŸ¥è©¢é‚è¼¯**ï¼š`src/data/fetcher.py`
- **BigQuery é…ç½®**ï¼š`config/bigquery.py`
- **è³‡æ–™ç”Ÿæˆ**ï¼š`src/generator/daily_aggregation.py`

### è³‡æ–™æµç¨‹
```
BigQuery è³‡æ–™å€‰å„²
â”œâ”€ datalake_stpl.lv1_order_master â†’ ç‡Ÿæ”¶ã€è¨‚å–®ã€AOV
â”œâ”€ analytics_304437305.events_* â†’ Sessionsã€CVR
â””â”€ ï¼ˆå¾…å»ºç«‹ï¼‰å»£å‘Šè³‡æ–™è¡¨ â†’ å»£å‘ŠèŠ±è²»ã€ROAS

â†“

DataFetcher æŸ¥è©¢
â†“

DailyAggregationGenerator ç”Ÿæˆ JSON
â†“

GoogleChatNotifier æ¨æ’­
```

---

## ğŸ“ ç›¸é—œæ–‡æª”

- [å®Œæ•´æ’ç¨‹è¨­å®šæŒ‡å—](./SCHEDULING_GUIDE.md)
- [è³‡æ–™å­˜å„²ä½ç½®èªªæ˜](./DATA_STORAGE.md)
- [MCP æ•´åˆè¦åŠƒ](./MCP_INTEGRATION_PLAN.md)

---

**æœ€å¾Œæ›´æ–°**ï¼š2025-01-27

