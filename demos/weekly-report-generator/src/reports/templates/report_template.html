<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»å•†é€±å ± - {{ brand_name }}</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, {{ colors.primary }} 0%, #6BA3E8 100%);
            color: white;
            padding: 40px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header .meta {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            color: #333;
            font-size: 24px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid {{ colors.primary }};
        }
        
        .chart-container {
            margin: 25px 0;
            min-height: 400px;
            background: #fafafa;
            border-radius: 8px;
            padding: 20px;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .kpi-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e9ecef;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .kpi-card .label {
            color: #666;
            font-size: 14px;
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .kpi-card .value {
            font-size: 36px;
            font-weight: bold;
            color: {{ colors.primary }};
            margin-bottom: 8px;
        }
        
        .kpi-card .sub-value {
            font-size: 12px;
            color: #999;
        }
        
        .comparison-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 8px;
        }
        
        .comparison-badge.positive {
            background: #e6f7e6;
            color: {{ colors.success }};
        }
        
        .comparison-badge.negative {
            background: #ffe6e6;
            color: {{ colors.danger }};
        }
        
        .footer {
            text-align: center;
            padding: 30px;
            color: #999;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å ±å‘Šæ¨™é¡Œ -->
        <div class="header">
            <h1>ğŸ“Š é›»å•†é€±å ± - {{ brand_name }}</h1>
            <div class="meta">
                {% if report_start_date and report_end_date %}
                    è§€å¯Ÿæ™‚é–“ï¼š{{ report_start_date }} è‡³ {{ report_end_date }}
                {% endif %}
                <br>
                ç”¢å‡ºæ™‚é–“ï¼š{{ output_date }}
            </div>
        </div>
        
        <!-- GMV åŸºæœ¬æŒ‡æ¨™ -->
        <div class="section">
            <h2>ğŸ’° GMV åŸºæœ¬æŒ‡æ¨™</h2>
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="label">æˆäº¤ç¸½é¡</div>
                    <div class="value">{{ format_currency(data.gmv_metrics.net_revenue) }}</div>
                    <div class="sub-value">æˆäº¤è¨‚å–®ç¸½é‡ï¼š{{ format_number(data.gmv_metrics.completed_orders) }} ç­†</div>
                    <div class="sub-value">å¹³å‡è¨‚å–®é‡‘é¡ï¼š{{ format_currency(data.gmv_metrics.net_revenue / data.gmv_metrics.completed_orders if data.gmv_metrics.completed_orders > 0 else 0) }}</div>
                </div>
                <div class="kpi-card">
                    <div class="label">ç¸½ç‡Ÿæ¥­é¡</div>
                    <div class="value">{{ format_currency(data.gmv_metrics.gross_revenue) }}</div>
                    <div class="sub-value">ç¸½è¨‚å–®ç¸½é‡ï¼š{{ format_number(data.gmv_metrics.total_orders) }} ç­†</div>
                    <div class="sub-value">äº¤æ˜“æœƒå“¡æ•¸ï¼š{{ format_number(data.gmv_metrics.get('unique_users', 0)) }} äºº</div>
                    <div class="sub-value">å–æ¶ˆç¸½é¡ï¼š{{ format_currency(data.gmv_metrics.get('cancelled_revenue', 0)) }}</div>
                </div>
            </div>
        </div>
        
        <!-- æœ¬é€±é—œéµæ‘˜è¦ï¼ˆåœ–æ–‡ä¸¦èŒ‚ï¼‰ -->
        {% if ai_summary or charts.weekly_comparison %}
        <div class="section">
            <h2>ğŸ“ˆ æœ¬é€±é—œéµæ‘˜è¦</h2>
            
            <!-- æ–‡å­—æ‘˜è¦ -->
            {% if ai_summary %}
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; line-height: 1.8; white-space: pre-line; margin-bottom: 25px;">{{ ai_summary }}</div>
            {% endif %}
            
            <!-- åœ–è¡¨èˆ‡æ•¸å€¼å¡ç‰‡ -->
            {% if charts.weekly_comparison %}
            <div class="kpi-grid" style="margin-bottom: 25px;">
                <div class="kpi-card">
                    <div class="label">ç‡Ÿæ”¶è®ŠåŒ–</div>
                    <div class="value">
                        {{ format_percentage(data.weekly_comparison.changes.revenue) }}
                        {% if data.weekly_comparison.changes.revenue >= 0 %}
                            <span class="comparison-badge positive">â†‘ æˆé•·</span>
                        {% else %}
                            <span class="comparison-badge negative">â†“ ä¸‹é™</span>
                        {% endif %}
                    </div>
                    <div class="sub-value">
                        ä¸Šé€±ï¼š{{ format_currency(data.weekly_comparison.this_week.net_revenue) }}<br>
                        ä¸Šä¸Šé€±ï¼š{{ format_currency(data.weekly_comparison.last_week.net_revenue) }}
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="label">è¨‚å–®æ•¸è®ŠåŒ–</div>
                    <div class="value">
                        {{ format_percentage(data.weekly_comparison.changes.orders) }}
                        {% if data.weekly_comparison.changes.orders >= 0 %}
                            <span class="comparison-badge positive">â†‘ æˆé•·</span>
                        {% else %}
                            <span class="comparison-badge negative">â†“ ä¸‹é™</span>
                        {% endif %}
                    </div>
                    <div class="sub-value">
                        ä¸Šé€±ï¼š{{ format_number(data.weekly_comparison.this_week.completed_orders) }} ç­†<br>
                        ä¸Šä¸Šé€±ï¼š{{ format_number(data.weekly_comparison.last_week.completed_orders) }} ç­†
                    </div>
                </div>
            </div>
            <div class="chart-container">
                {{ charts.weekly_comparison|safe }}
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- æµé‡åˆ†æ -->
        {% if data.traffic_analysis %}
        <div class="section">
            <h2>ğŸŒ æµé‡åˆ†æ</h2>
            
            <!-- æµé‡è¡¨ç¾è¡¨æ ¼ -->
            <div style="background: #fafafa; padding: 20px; border-radius: 8px; margin-bottom: 25px; overflow-x: auto;">
                <h3 style="margin-bottom: 15px; color: #333; font-size: 18px;">æµé‡ä¾†æº</h3>
                <table style="width: 100%; border-collapse: collapse; background: white;">
                    <thead>
                        <tr style="background: #1890ff; color: white;">
                            <th style="padding: 12px; text-align: left; font-weight: 600; border: 1px solid #ddd;">æµé‡ä¾†æº</th>
                            <th style="padding: 12px; text-align: right; font-weight: 600; border: 1px solid #ddd;">ç¸½è³¼è²·æ”¶ç›Š</th>
                            <th style="padding: 12px; text-align: right; font-weight: 600; border: 1px solid #ddd;">å·¥ä½œéšæ®µ</th>
                            <th style="padding: 12px; text-align: right; font-weight: 600; border: 1px solid #ddd;">é›»å­å•†å‹™è½‰æ›ç‡</th>
                            <th style="padding: 12px; text-align: right; font-weight: 600; border: 1px solid #ddd;">äº¤æ˜“</th>
                            <th style="padding: 12px; text-align: right; font-weight: 600; border: 1px solid #ddd;">å¹³å‡è³¼è²·æ”¶ç›Š</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for traffic in data.traffic_analysis %}
                        <tr style="border-bottom: 1px solid #eee;">
                            <td style="padding: 10px 12px; border: 1px solid #ddd;">{{ traffic.traffic_source }}</td>
                            <td style="padding: 10px 12px; text-align: right; border: 1px solid #ddd;">{{ format_currency(traffic.revenue) }}</td>
                            <td style="padding: 10px 12px; text-align: right; border: 1px solid #ddd;">{{ format_number(traffic.sessions) }}</td>
                            <td style="padding: 10px 12px; text-align: right; border: 1px solid #ddd;">{{ format_percentage(traffic.cvr) }}</td>
                            <td style="padding: 10px 12px; text-align: right; border: 1px solid #ddd;">{{ format_number(traffic.conversions) }}</td>
                            <td style="padding: 10px 12px; text-align: right; border: 1px solid #ddd;">{{ format_currency(traffic.aov) }}</td>
                        </tr>
                        {% endfor %}
                        <!-- ç¸½è¨ˆè¡Œ -->
                        {% if data.traffic_analysis %}
                        {% set total_revenue = 0 %}
                        {% set total_sessions = 0 %}
                        {% set total_conversions = 0 %}
                        {% for traffic in data.traffic_analysis %}
                            {% set total_revenue = total_revenue + (traffic.revenue | default(0) | float) %}
                            {% set total_sessions = total_sessions + (traffic.sessions | default(0) | int) %}
                            {% set total_conversions = total_conversions + (traffic.conversions | default(0) | int) %}
                        {% endfor %}
                        {% set overall_cvr = (total_conversions / total_sessions * 100) if total_sessions > 0 else 0 %}
                        {% set overall_aov = (total_revenue / total_conversions) if total_conversions > 0 else 0 %}
                        <tr style="background: #f0f0f0; font-weight: 600; border-top: 2px solid #1890ff;">
                            <td style="padding: 12px; border: 1px solid #ddd;">ç¸½è¨ˆ</td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #ddd;">
                                {{ format_currency(total_revenue) }}
                            </td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #ddd;">
                                {{ format_number(total_sessions) }}
                            </td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #ddd;">
                                {{ format_percentage(overall_cvr) }}
                            </td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #ddd;">
                                {{ format_number(total_conversions) }}
                            </td>
                            <td style="padding: 12px; text-align: right; border: 1px solid #ddd;">
                                {{ format_currency(overall_aov) }}
                            </td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            
            <!-- ä¿ç•™åœ–è¡¨ï¼ˆå¯é¸ï¼‰ -->
            {% if charts.traffic_source %}
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="chart-container">
                    {{ charts.traffic_source.pie|safe }}
                </div>
                <div class="chart-container">
                    {{ charts.traffic_source.bar|safe }}
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- AOV åˆ†æ -->
        {% if data.aov_analysis %}
        <div class="section">
            <h2>ğŸ›’ å¹³å‡è¨‚å–®é‡‘é¡åˆ†æ</h2>
            
            <!-- å…©å€‹è¡¨æ ¼ï¼šè³¼ç‰©è»Šä»¶æ•¸åˆ†å¸ƒå’Œåƒ¹æ ¼å¸¶ -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                <!-- è³¼ç‰©è»Šä»¶æ•¸åˆ†å¸ƒè¡¨æ ¼ -->
                <div style="background: #fafafa; padding: 20px; border-radius: 8px;">
                    <h3 style="margin-bottom: 15px; color: #666; font-size: 18px;">è³¼ç‰©è»Šä»¶æ•¸åˆ†å¸ƒ</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f0f0f0; border-bottom: 2px solid #ddd;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">ä»¶æ•¸</th>
                                <th style="padding: 12px; text-align: right; font-weight: 600;">è¨‚å–®æ•¸</th>
                                <th style="padding: 12px; text-align: right; font-weight: 600;">å¹³å‡è¨‚å–®é‡‘é¡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in data.aov_analysis.item_distribution %}
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 10px 12px;">{{ item.item_count }}</td>
                                <td style="padding: 10px 12px; text-align: right;">{{ format_number(item.order_count) }}</td>
                                <td style="padding: 10px 12px; text-align: right;">{{ format_currency(item.avg_amount) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- åƒ¹æ ¼å¸¶çµæ§‹è¡¨æ ¼ -->
                <div style="background: #fafafa; padding: 20px; border-radius: 8px;">
                    <h3 style="margin-bottom: 15px; color: #666; font-size: 18px;">åƒ¹æ ¼å¸¶çµæ§‹</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f0f0f0; border-bottom: 2px solid #ddd;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">åƒ¹æ ¼å¸¶</th>
                                <th style="padding: 12px; text-align: right; font-weight: 600;">è¨‚å–®æ•¸</th>
                                <th style="padding: 12px; text-align: right; font-weight: 600;">å¹³å‡è¨‚å–®é‡‘é¡</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for price in data.aov_analysis.price_band_distribution %}
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 10px 12px;">{{ price.price_band }}</td>
                                <td style="padding: 10px 12px; text-align: right;">{{ format_number(price.order_count) }}</td>
                                <td style="padding: 10px 12px; text-align: right;">{{ format_currency(price.avg_amount) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- åˆ†ææ–‡å­—å€å¡Š -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; line-height: 1.8;">
                <h3 style="margin-bottom: 15px; color: #333; font-size: 16px;">ğŸ“Š åˆ†æè§€å¯Ÿ</h3>
                <div style="white-space: pre-line;">
                    {% if data.aov_analysis.item_distribution %}
                    <p><strong>è³¼ç‰©è»Šä»¶æ•¸åˆ†æï¼š</strong></p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        {% for item in data.aov_analysis.item_distribution %}
                        <li>{{ item.item_count }}ï¼š{{ format_number(item.order_count) }} ç­†è¨‚å–®ï¼Œå¹³å‡è¨‚å–®é‡‘é¡ {{ format_currency(item.avg_amount) }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                    
                    {% if data.aov_analysis.price_band_distribution %}
                    <p><strong>åƒ¹æ ¼å¸¶åˆ†æï¼š</strong></p>
                    <ul style="margin-left: 20px;">
                        {% for price in data.aov_analysis.price_band_distribution %}
                        <li>{{ price.price_band }}ï¼š{{ format_number(price.order_count) }} ç­†è¨‚å–®ï¼Œå¹³å‡è¨‚å–®é‡‘é¡ {{ format_currency(price.avg_amount) }}</li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- è½‰æ›æ¼æ–— -->
        {% if charts.conversion_funnel %}
        <div class="section">
            <h2>ğŸ”½ è½‰æ›ç‡æ¼æ–—åˆ†æ</h2>
            <div class="chart-container">
                {{ charts.conversion_funnel|safe }}
            </div>
        </div>
        {% endif %}
        
        <!-- å ±å‘Šçµå°¾ -->
        <div class="footer">
            <p>æœ¬å ±å‘Šç”± AI ç‡Ÿé‹é¡§å•ç³»çµ±è‡ªå‹•ç”Ÿæˆ</p>
            <p>å¦‚æœ‰ç–‘å•ï¼Œè«‹è¯ç¹«è³‡æ–™åœ˜éšŠ</p>
        </div>
    </div>
</body>
</html>

