# 更新日誌

記錄所有重要的變更和更新。

---

## 2025-11-05

### ✨ 新增功能

- **時間範圍計算**：改為週一到週日（而非最近 7 天）
  - 新增 `get_week_range()` 和 `get_last_week_range()` 函數
  - 所有查詢方法改用 `start_date` 和 `end_date` 參數

- **AI 摘要功能**：新增規則式摘要生成
  - 實作 `ai_summary.py` 模組
  - 分析營收表現、與上週比較、流量來源分析
  - 提供具體建議（目前為規則式，後續可整合 LLM）

- **交易會員數**：新增交易會員數指標
  - 在 GMV 指標中新增 `unique_users` 欄位
  - 在報告中顯示交易會員數

- **報告時間顯示**：
  - 新增「觀察時間」顯示（週一到週日範圍）
  - 將「生成時間」改為「產出時間」

### 🔧 修正

- **SQL 查詢邏輯**：根據實際資料表結構調整
  - 使用 `ord_rev` 欄位（而非 `ord_total`）
  - 使用 `bhv1 <> '取消'` 判斷取消訂單（而非 `return_ord_id IS NULL`）
  - 修正指標定義（成交總額、總營業額、訂單數等）

- **流量分析圖表**：
  - 修正顏色配置，確保不同流量來源有不同顏色
  - 標籤放在圖表外面，避免與圖表重疊
  - 柱狀圖標籤顯示在柱頂

- **數字格式化**：
  - 百分比：兩位小數（例如：`5.01%`）
  - 金額：整數（例如：`NT$ 518,919`）
  - 訂單數：整數（例如：`238`）

- **漏斗圖視覺效果**：
  - 使用 `sort_="descending"` 讓漏斗從大到小排序
  - 設定 `gap=2` 增加階層間距

- **流量分析 JOIN 邏輯**：
  - 分步查詢 GA4 和 Shopline 資料
  - 在 Python 中 JOIN，避免位置錯誤

### 📝 文件

- 新增 `HANDOVER_DOCUMENT.md`：完整交接文件
- 新增 `QUICK_START.md`：快速開始指南
- 新增 `CODE_STRUCTURE.md`：程式碼結構說明
- 新增 `CHANGELOG.md`：更新日誌（本文件）

---

## 2025-01-27

### ✨ 初始版本

- 建立專案架構
- 實作 BigQuery 連線
- 實作資料查詢模組（GMV、流量分析、AOV、轉換漏斗）
- 實作流量分類邏輯（8 種分類）
- 實作 PyEcharts 圖表生成
- 實作 HTML 報告模板
- 驗證 Transaction ID 格式一致性

---

**維護者**：請在每次重大更新時記錄在此文件中。

