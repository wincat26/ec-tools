# é›»å•†é€±å ±ç”Ÿæˆå™¨ - äº¤æ¥æ–‡ä»¶

**æ–‡ä»¶ç‰ˆæœ¬**ï¼šv1.0  
**æœ€å¾Œæ›´æ–°**ï¼š2025-11-05  
**ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ

---

## ğŸ“‹ ç›®éŒ„

1. [å°ˆæ¡ˆæ¦‚è¿°](#å°ˆæ¡ˆæ¦‚è¿°)
2. [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
3. [æŠ€è¡“æ£§èˆ‡ä¾è³´](#æŠ€è¡“æ£§èˆ‡ä¾è³´)
4. [å°ˆæ¡ˆçµæ§‹](#å°ˆæ¡ˆçµæ§‹)
5. [è³‡æ–™åº«é…ç½®](#è³‡æ–™åº«é…ç½®)
6. [æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„](#æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„)
7. [ä½¿ç”¨èªªæ˜](#ä½¿ç”¨èªªæ˜)
8. [é—œéµé‚è¼¯èªªæ˜](#é—œéµé‚è¼¯èªªæ˜)
9. [å¸¸è¦‹å•é¡Œèˆ‡æ’éŒ¯](#å¸¸è¦‹å•é¡Œèˆ‡æ’éŒ¯)
10. [å¾…è¾¦äº‹é …èˆ‡æœªä¾†è¦åŠƒ](#å¾…è¾¦äº‹é …èˆ‡æœªä¾†è¦åŠƒ)
11. [ç›¸é—œæ–‡ä»¶](#ç›¸é—œæ–‡ä»¶)

---

## ğŸ“– å°ˆæ¡ˆæ¦‚è¿°

### å°ˆæ¡ˆç›®çš„

é›»å•†é€±å ±ç”Ÿæˆå™¨æ˜¯ä¸€å€‹è‡ªå‹•åŒ–å·¥å…·ï¼Œç”¨æ–¼ï¼š
- å¾ BigQuery æŸ¥è©¢é›»å•†ç‡Ÿé‹è³‡æ–™
- æ•´åˆ GA4 æµé‡åˆ†æè³‡æ–™
- ç”ŸæˆåŒ…å«åœ–è¡¨å’Œ AI æ‘˜è¦çš„ HTML é€±å ±
- æä¾›æ¯é€±ä¸€åˆ°é€±æ—¥çš„æ•¸æ“šåˆ†æå ±å‘Š

### æ ¸å¿ƒåŠŸèƒ½

1. **GMV åŸºæœ¬æŒ‡æ¨™**ï¼šæˆäº¤ç¸½é¡ã€ç¸½ç‡Ÿæ¥­é¡ã€äº¤æ˜“æœƒå“¡æ•¸ã€è¨‚å–®çµ±è¨ˆ
2. **æœ¬é€±é—œéµæ‘˜è¦**ï¼šèˆ‡ä¸Šé€±çš„æ¯”è¼ƒåˆ†æï¼ˆç‡Ÿæ”¶ã€è¨‚å–®æ•¸è®ŠåŒ–ï¼‰
3. **æµé‡åˆ†æ**ï¼š8 ç¨®æµé‡ä¾†æºçš„åˆ†é¡èˆ‡åˆ†æï¼ˆSessionsã€CVRã€AOVã€ç‡Ÿæ”¶ï¼‰
4. **AOV åˆ†æ**ï¼šè³¼ç‰©è»Šä»¶æ•¸åˆ†å¸ƒã€åƒ¹æ ¼å¸¶çµæ§‹
5. **è½‰æ›æ¼æ–—**ï¼šå¾è¨ªå®¢åˆ°æˆäº¤çš„è½‰æ›ç‡åˆ†æ
6. **AI æ‘˜è¦**ï¼šè‡ªå‹•ç”Ÿæˆé€±å ±è§€å¯Ÿèˆ‡å»ºè­°ï¼ˆç›®å‰ç‚ºè¦å‰‡å¼ï¼Œå¾ŒçºŒå¯æ•´åˆ LLMï¼‰

### å ±å‘Šæ™‚é–“ç¯„åœ

- **è§€å¯Ÿæ™‚é–“**ï¼šæœ¬é€±é€±ä¸€åˆ°é€±æ—¥ï¼ˆä¾‹å¦‚ï¼š2025-11-04 è‡³ 2025-11-10ï¼‰
- **æ¯”è¼ƒåŸºæº–**ï¼šä¸Šé€±é€±ä¸€åˆ°ä¸Šé€±æ—¥
- **ç”¢å‡ºæ™‚é–“**ï¼šå ±å‘Šç”Ÿæˆçš„æ™‚é–“æˆ³è¨˜

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é€±å ±ç”Ÿæˆå™¨æµç¨‹                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. è³‡æ–™æŸ¥è©¢å±¤ (Data Fetcher)
   â”œâ”€ BigQuery é€£ç·š
   â”œâ”€ SQL æŸ¥è©¢åŸ·è¡Œ
   â””â”€ è³‡æ–™è½‰æ›ç‚º DataFrame

2. è³‡æ–™è™•ç†å±¤ (Data Processor)
   â”œâ”€ KPI è¨ˆç®—
   â”œâ”€ é€±æœŸæ¯”è¼ƒ
   â””â”€ è³‡æ–™æ ¼å¼åŒ–

3. åœ–è¡¨ç”Ÿæˆå±¤ (Chart Generator)
   â”œâ”€ PyEcharts åœ–è¡¨ç”Ÿæˆ
   â”œâ”€ æµé‡åˆ†é¡é‚è¼¯
   â””â”€ HTML åµŒå…¥

4. AI æ‘˜è¦å±¤ (AI Summary)
   â”œâ”€ è¦å‰‡å¼æ‘˜è¦ï¼ˆç›®å‰ï¼‰
   â””â”€ LLM æ•´åˆï¼ˆæœªä¾†ï¼‰

5. å ±å‘Šçµ„åˆå±¤ (Report Builder)
   â”œâ”€ Jinja2 æ¨¡æ¿æ¸²æŸ“
   â”œâ”€ è³‡æ–™æ•´åˆ
   â””â”€ HTML è¼¸å‡º
```

### è³‡æ–™æµç¨‹

```
BigQuery (GA4 + Shopline)
    â†“
DataFetcher (SQL æŸ¥è©¢)
    â†“
DataProcessor (è³‡æ–™è™•ç†)
    â†“
ChartGenerator (PyEcharts)
    â†“
AI Summary (æ–‡å­—ç”Ÿæˆ)
    â†“
ReportBuilder (HTML çµ„åˆ)
    â†“
è¼¸å‡º HTML å ±å‘Š
```

---

## ğŸ› ï¸ æŠ€è¡“æ£§èˆ‡ä¾è³´

### Python ç‰ˆæœ¬

- **Python 3.11+**

### æ ¸å¿ƒä¾è³´å¥—ä»¶

```txt
# BigQuery è³‡æ–™æŸ¥è©¢
google-cloud-bigquery>=3.11.0
google-auth>=2.23.0
db-dtypes>=1.2.0  # BigQuery è³‡æ–™é¡å‹æ”¯æ´

# è³‡æ–™è™•ç†
pandas>=2.0.0
numpy>=1.24.0

# åœ–è¡¨ç”Ÿæˆ
pyecharts>=2.0.0

# æ¨¡æ¿å¼•æ“
jinja2>=3.1.0

# ç’°å¢ƒè®Šæ•¸ç®¡ç†
python-dotenv>=1.0.0

# æ—¥æœŸè™•ç†
python-dateutil>=2.8.0
```

### å®‰è£æ–¹å¼

```bash
# é€²å…¥å°ˆæ¡ˆç›®éŒ„
cd weekly-report-generator

# å®‰è£ä¾è³´
pip install -r requirements.txt
```

### Google Cloud èªè­‰

éœ€è¦è¨­å®š Google Cloud èªè­‰æ‰èƒ½é€£æ¥ BigQueryï¼š

```bash
# è¨­å®šé è¨­å°ˆæ¡ˆ
gcloud config set project datalake360-saintpaul

# è¨­å®š Application Default Credentials
gcloud auth application-default login

# è¨­å®š quota projectï¼ˆé¿å…æ¬Šé™è­¦å‘Šï¼‰
gcloud auth application-default set-quota-project datalake360-saintpaul
```

è©³ç´°èªè­‰è¨­å®šè«‹åƒè€ƒï¼š`AUTHENTICATION_SETUP.md`

---

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
weekly-report-generator/
â”œâ”€â”€ README.md                          # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â”œâ”€â”€ HANDOVER_DOCUMENT.md               # æœ¬äº¤æ¥æ–‡ä»¶ï¼ˆé‡è¦ï¼ï¼‰
â”œâ”€â”€ requirements.txt                   # Python ä¾è³´å¥—ä»¶
â”œâ”€â”€ .env.example                       # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”œâ”€â”€ .gitignore                         # Git å¿½ç•¥æª”æ¡ˆ
â”‚
â”œâ”€â”€ config/                            # é…ç½®æ¨¡çµ„
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ bigquery_config.py            # BigQuery é€£ç·šè¨­å®š
â”‚   â””â”€â”€ chart_config.py               # åœ–è¡¨æ¨£å¼è¨­å®š
â”‚
â”œâ”€â”€ src/                               # æ ¸å¿ƒç¨‹å¼ç¢¼
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                        # ä¸»ç¨‹å¼å…¥å£
â”‚   â”œâ”€â”€ data_fetcher.py                # BigQuery è³‡æ–™æŸ¥è©¢
â”‚   â”œâ”€â”€ data_processor.py              # è³‡æ–™è™•ç†ï¼ˆç›®å‰æœªä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ traffic_classifier.py          # æµé‡ä¾†æºåˆ†é¡é‚è¼¯
â”‚   â”œâ”€â”€ chart_generator.py             # PyEcharts åœ–è¡¨ç”Ÿæˆ
â”‚   â”œâ”€â”€ ai_summary.py                  # AI æ‘˜è¦ç”Ÿæˆ
â”‚   â”œâ”€â”€ report_builder.py              # HTML å ±å‘Šçµ„åˆ
â”‚   â””â”€â”€ utils.py                       # å·¥å…·å‡½æ•¸ï¼ˆæ—¥æœŸè¨ˆç®—ã€æ ¼å¼åŒ–ï¼‰
â”‚
â”œâ”€â”€ templates/                         # HTML æ¨¡æ¿
â”‚   â””â”€â”€ report_template.html           # é€±å ± HTML æ¨¡æ¿
â”‚
â”œâ”€â”€ output/                            # è¼¸å‡ºç›®éŒ„
â”‚   â””â”€â”€ weekly_report_*.html          # ç”Ÿæˆçš„é€±å ±æª”æ¡ˆ
â”‚
â””â”€â”€ æ–‡ä»¶è³‡æ–™å¤¾/
    â”œâ”€â”€ AUTHENTICATION_SETUP.md        # èªè­‰è¨­å®šæŒ‡å—
    â”œâ”€â”€ CONFIGURATION_SUMMARY.md       # é…ç½®ç¸½çµ
    â”œâ”€â”€ DATABASE_SCHEMA.md             # è³‡æ–™åº«çµæ§‹èªªæ˜
    â”œâ”€â”€ SQL_QUERY_UPDATE.md            # SQL æŸ¥è©¢æ›´æ–°è¨˜éŒ„
    â”œâ”€â”€ TRAFFIC_CLASSIFICATION.md      # æµé‡åˆ†é¡è¦å‰‡
    â”œâ”€â”€ TRAFFIC_ANALYSIS_IMPLEMENTATION.md  # æµé‡åˆ†æå¯¦ä½œ
    â”œâ”€â”€ TRANSACTION_ID_VERIFICATION.md # Transaction ID é©—è­‰
    â”œâ”€â”€ FINAL_SUMMARY.md               # å®Œæˆç¸½çµ
    â””â”€â”€ test_*.py                      # æ¸¬è©¦è…³æœ¬
```

---

## ğŸ—„ï¸ è³‡æ–™åº«é…ç½®

### BigQuery å°ˆæ¡ˆè¨­å®š

**å°ˆæ¡ˆ ID**ï¼š`datalake360-saintpaul`

**è³‡æ–™é›†**ï¼š
- `datalake_stpl`ï¼šShopline è¨‚å–®è³‡æ–™
- `analytics_304437305`ï¼šGA4 äº‹ä»¶è³‡æ–™

**ä½ç½®**ï¼š`asia-northeast1`ï¼ˆè‡ªå‹•åµæ¸¬ï¼‰

### é—œéµè³‡æ–™è¡¨

#### Shopline è¨‚å–®è¡¨

| è³‡æ–™è¡¨ | ç”¨é€” | é—œéµæ¬„ä½ |
|--------|------|---------|
| `lv1_order_master` | è¨‚å–®ä¸»æª” | `ord_id`, `ord_rev`, `user_id`, `dt`, `bhv1`, `touch_class` |
| `lv1_order` | è¨‚å–®æ˜ç´° | `ord_id`, `pro_id`, `ord_qty`, `ord_price` |

#### GA4 äº‹ä»¶è¡¨

| è³‡æ–™è¡¨ | ç”¨é€” | é—œéµæ¬„ä½ |
|--------|------|---------|
| `events_YYYYMMDD` | æ—¥æœŸåˆ†å€äº‹ä»¶è¡¨ | `event_name`, `user_pseudo_id`, `event_params`, `traffic_source` |

### é‡è¦æ¬„ä½èªªæ˜

#### `lv1_order_master` é—œéµæ¬„ä½

- **`ord_rev`**ï¼šè¨‚å–®é‡‘é¡ï¼ˆä½¿ç”¨æ­¤æ¬„ä½ï¼Œä¸æ˜¯ `ord_total`ï¼‰
- **`bhv1`**ï¼šè¨‚å–®ç‹€æ…‹ï¼ˆ`'å–æ¶ˆ'` è¡¨ç¤ºå–æ¶ˆè¨‚å–®ï¼‰
- **`dt`**ï¼šè¨‚å–®æ—¥æœŸï¼ˆTIMESTAMPï¼‰
- **`touch_class`**ï¼šé€šè·¯ç¨®é¡ï¼ˆ`'ec'` è¡¨ç¤ºé›»å•†é€šè·¯ï¼‰
- **`user_id`**ï¼šæœƒå“¡ ID
- **`ord_id`**ï¼šè¨‚å–®ç·¨è™Ÿï¼ˆ17 ä½æ•¸å­—ï¼Œæ ¼å¼ï¼š`YYYYMMDDHHMMSSNNN`ï¼‰

#### GA4 äº‹ä»¶è¡¨é—œéµæ¬„ä½

- **`event_name`**ï¼šäº‹ä»¶åç¨±ï¼ˆ`'session_start'`, `'purchase'`, `'view_item'` ç­‰ï¼‰
- **`event_params`**ï¼šäº‹ä»¶åƒæ•¸ï¼ˆARRAYï¼ŒåŒ…å« `transaction_id`ï¼‰
- **`traffic_source`**ï¼šæµé‡ä¾†æºï¼ˆRECORDï¼ŒåŒ…å« `source` å’Œ `medium`ï¼‰
- **`session_traffic_source_last_click`**ï¼šæœ€å¾Œé»æ“Šçš„æµé‡ä¾†æºï¼ˆRECORDï¼‰

### æŸ¥è©¢é‚è¼¯é‡é»

#### 1. GMV æŒ‡æ¨™æŸ¥è©¢

```sql
-- æˆäº¤ç¸½é¡ï¼šæ‰€æœ‰è¨‚å–®çš„ ord_rev
SUM(ord_rev) as net_revenue

-- ç¸½ç‡Ÿæ¥­é¡ï¼šæ’é™¤å–æ¶ˆè¨‚å–®çš„ ord_rev
SUM(CASE WHEN bhv1 <> 'å–æ¶ˆ' THEN ord_rev ELSE 0 END) as gross_revenue

-- æˆäº¤è¨‚å–®ç¸½é‡ï¼šæ‰€æœ‰è¨‚å–®æ•¸ï¼ˆåŒ…å«å–æ¶ˆï¼‰
COUNT(DISTINCT ord_id) as completed_orders

-- ç¸½è¨‚å–®ç¸½é‡ï¼šæ’é™¤å–æ¶ˆçš„è¨‚å–®æ•¸
SUM(CASE WHEN bhv1 <> 'å–æ¶ˆ' THEN 1 ELSE 0 END) as total_orders

-- äº¤æ˜“æœƒå“¡æ•¸
COUNT(DISTINCT user_id) as unique_users
```

**é‡è¦**ï¼šå–æ¶ˆè¨‚å–®çš„åˆ¤æ–·æ˜¯ `bhv1 = 'å–æ¶ˆ'`ï¼Œä¸æ˜¯ `return_ord_id IS NULL`

#### 2. Transaction ID å°æ‡‰

- GA4 çš„ `transaction_id` æ ¼å¼ï¼š17 ä½æ•¸å­—ï¼ˆä¾‹å¦‚ï¼š`20241105153444114`ï¼‰
- Shopline çš„ `ord_id` æ ¼å¼ï¼š17 ä½æ•¸å­—ï¼ˆå®Œå…¨ç›¸åŒï¼‰
- **å¯ä»¥ç›´æ¥ JOIN**ï¼š`transaction_id = ord_id`

#### 3. æ—¥æœŸç¯„åœè¨ˆç®—

- **æœ¬é€±**ï¼šä½¿ç”¨ `get_week_range()` è¨ˆç®—é€±ä¸€åˆ°é€±æ—¥
- **ä¸Šé€±**ï¼šä½¿ç”¨ `get_last_week_range()` è¨ˆç®—ä¸Šé€±ä¸€åˆ°ä¸Šé€±æ—¥
- **æ—¥æœŸåˆ†å€**ï¼šGA4 äº‹ä»¶è¡¨ä½¿ç”¨ `_TABLE_SUFFIX` éæ¿¾ï¼ˆæ ¼å¼ï¼š`YYYYMMDD`ï¼‰

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„

### 1. DataFetcher (`src/data_fetcher.py`)

è² è²¬å¾ BigQuery æŸ¥è©¢è³‡æ–™ã€‚

#### ä¸»è¦æ–¹æ³•

| æ–¹æ³• | åŠŸèƒ½ | åƒæ•¸ | è¿”å› |
|------|------|------|------|
| `fetch_gmv_metrics()` | æŸ¥è©¢ GMV åŸºæœ¬æŒ‡æ¨™ | `start_date`, `end_date` | `dict` |
| `fetch_weekly_comparison()` | æŸ¥è©¢æœ¬é€±èˆ‡ä¸Šé€±æ¯”è¼ƒ | ç„¡ | `dict` |
| `fetch_traffic_analysis()` | æŸ¥è©¢æµé‡åˆ†æ | `start_date`, `end_date` | `DataFrame` |
| `fetch_aov_analysis()` | æŸ¥è©¢ AOV åˆ†æ | `start_date`, `end_date`, `dimension` | `dict` |
| `fetch_conversion_funnel()` | æŸ¥è©¢è½‰æ›æ¼æ–— | `start_date`, `end_date` | `dict` |

#### é—œéµæŸ¥è©¢é‚è¼¯

**æµé‡åˆ†æ**ï¼š
- åˆ†å…©æ­¥æŸ¥è©¢ï¼ˆé¿å…ä½ç½®éŒ¯èª¤ï¼‰
- æ­¥é©Ÿ 1ï¼šæŸ¥è©¢ GA4 Sessionsï¼ˆæŒ‰æµé‡ä¾†æºåˆ†çµ„ï¼‰
- æ­¥é©Ÿ 2ï¼šæŸ¥è©¢ GA4 Purchases + JOIN Shopline è¨‚å–®ï¼ˆåœ¨ Python ä¸­ JOINï¼‰
- åŸå› ï¼šGA4 å’Œ Shopline è¡¨å¯èƒ½åœ¨ä¸åŒä½ç½®ï¼Œç›´æ¥ SQL JOIN æœƒå¤±æ•—

### 2. TrafficClassifier (`src/traffic_classifier.py`)

æµé‡ä¾†æºåˆ†é¡é‚è¼¯ï¼Œå°‡ GA4 çš„ `source` å’Œ `medium` åˆ†é¡ç‚º 8 ç¨®é¡åˆ¥ã€‚

#### åˆ†é¡è¦å‰‡

| åˆ†é¡ | è¦å‰‡ | SQL æ¢ä»¶ |
|------|------|---------|
| 1. ç›´æ¥æµé‡ | `source = '(direct)'` AND `medium = '(none)'` | `source = '(direct)' AND (medium = '(none)' OR medium = '(not set)')` |
| 2. è‡ªç„¶æœå°‹ | `source/medium` åŒ…å« `/ organic` æˆ–åŒ…å« `search` | `REGEXP_CONTAINS(LOWER(source_medium), r'/ organic$|.*search.*')` |
| 3. ä»˜è²»å»£å‘Š | `medium` ç‚º `ads|cpc|paid|ppc|cpm|pmax|ad|fb-SiteLink` | `REGEXP_CONTAINS(source_medium, r'/ (ads\|cpc\|paid\|ppc\|cpm\|pmax\|ad\|fb-SiteLink)$')` |
| 4. æœƒå“¡ç¶“ç‡Ÿ | `source/medium` åŒ…å« `edm|line|push|sms|cdp|crm` | `REGEXP_CONTAINS(source_medium, r'(edm\|line\|push\|sms\|cdp\|crm)')` |
| 5. AI åŠ©ç† | `source` é–‹é ­ç‚º `chatgpt|perplexity|copilot|bard|gemini` | `REGEXP_CONTAINS(LOWER(source_medium), r'^(chatgpt\|perplexity\|copilot\|bard\|gemini)')` |
| 6. ç¤¾ç¾¤åª’é«” | `source/medium` åŒ…å« `facebook|threads|instagram|t.co|line|linktr.ee|pinterest|linkedin` | `REGEXP_CONTAINS(source_medium, r'(facebook\|threads\|instagram|t\\.co\|line\|linktr\\.ee\|pinterest\|linkedin)')` |
| 7. åƒç…§é€£çµ | `medium = 'referral'` | `REGEXP_CONTAINS(source_medium, r'/ referral$')` |
| 8. å…¶ä»– | ä¸ç¬¦åˆä»¥ä¸Šè¦å‰‡ | `ELSE '8. å…¶ä»–'` |

#### ä½¿ç”¨æ–¹æ³•

```python
from src.traffic_classifier import classify_traffic_source, classify_traffic_source_sql

# Python å‡½å¼
category = classify_traffic_source('google', 'organic')  # è¿”å› '2. è‡ªç„¶æœå°‹'

# SQL èªå¥ç”Ÿæˆ
sql = classify_traffic_source_sql('ts.source', 'ts.medium')
```

### 3. ChartGenerator (`src/chart_generator.py`)

ä½¿ç”¨ PyEcharts ç”Ÿæˆäº’å‹•å¼åœ–è¡¨ã€‚

#### ç”Ÿæˆçš„åœ–è¡¨é¡å‹

1. **æœ¬é€±é—œéµæ‘˜è¦åœ–è¡¨**ï¼šæŸ±ç‹€åœ–ï¼ˆç‡Ÿæ”¶è®ŠåŒ–ã€è¨‚å–®æ•¸è®ŠåŒ–ï¼‰
2. **æµé‡ä¾†æºåˆ†å¸ƒåœ–**ï¼šé¤…åœ–ï¼ˆSessionsï¼‰ + æŸ±ç‹€åœ–ï¼ˆç‡Ÿæ”¶ï¼‰
3. **AOV åˆ†å¸ƒåœ–**ï¼šé›™ Y è»¸æŸ±ç‹€åœ–ï¼ˆè³¼ç‰©è»Šä»¶æ•¸ï¼‰ + å †ç–Šåœ–ï¼ˆåƒ¹æ ¼å¸¶ï¼‰
4. **è½‰æ›æ¼æ–—åœ–**ï¼šæ¼æ–—åœ–ï¼ˆå¾å¤§åˆ°å°æ’åºï¼‰

#### åœ–è¡¨é…ç½®

- **ä¸»é¡Œ**ï¼šMACARONSï¼ˆå¯åœ¨ `config/chart_config.py` ä¿®æ”¹ï¼‰
- **é¡è‰²**ï¼šä½¿ç”¨ `TRAFFIC_SOURCE_COLORS` å°æ‡‰æµé‡ä¾†æº
- **å­—é«”å¤§å°**ï¼šçµ±ä¸€åœ¨ `config/chart_config.py` ä¸­è¨­å®š

### 4. AI Summary (`src/ai_summary.py`)

ç”Ÿæˆé€±å ±çš„æ–‡å­—æ‘˜è¦ã€‚

#### ç›®å‰å¯¦ä½œ

- **æ¨¡å¼**ï¼šè¦å‰‡å¼ç”Ÿæˆï¼ˆ`use_llm=False`ï¼‰
- **åŠŸèƒ½**ï¼š
  - åˆ†æç‡Ÿæ”¶è¡¨ç¾
  - èˆ‡ä¸Šé€±æ¯”è¼ƒ
  - æµé‡ä¾†æºåˆ†æ
  - æä¾›å»ºè­°

#### æœªä¾†è¦åŠƒ

- æ•´åˆ LLM APIï¼ˆOpenAIã€Anthropic ç­‰ï¼‰
- æ›´æ™ºèƒ½çš„è§€å¯Ÿèˆ‡å»ºè­°
- å¯è‡ªè¨‚ prompt

### 5. ReportBuilder (`src/report_builder.py`)

çµ„åˆæ‰€æœ‰è³‡æ–™å’Œåœ–è¡¨ï¼Œç”Ÿæˆæœ€çµ‚çš„ HTML å ±å‘Šã€‚

#### å·¥ä½œæµç¨‹

1. è®€å– HTML æ¨¡æ¿ï¼ˆ`templates/report_template.html`ï¼‰
2. ç”Ÿæˆ AI æ‘˜è¦
3. ä½¿ç”¨ Jinja2 æ¸²æŸ“æ¨¡æ¿
4. å„²å­˜åˆ° `output/` ç›®éŒ„

#### è¼¸å‡ºæª”æ¡ˆå‘½å

æ ¼å¼ï¼š`weekly_report_YYYYMMDD_HHMMSS.html`

ä¾‹å¦‚ï¼š`weekly_report_20251105_111952.html`

### 6. Utils (`src/utils.py`)

å·¥å…·å‡½æ•¸ã€‚

#### ä¸»è¦å‡½æ•¸

| å‡½æ•¸ | åŠŸèƒ½ | ç¯„ä¾‹ |
|------|------|------|
| `get_week_range()` | è¨ˆç®—æŒ‡å®šæ—¥æœŸæ‰€åœ¨é€±çš„é€±ä¸€åˆ°é€±æ—¥ | `(date(2025, 11, 4), date(2025, 11, 10))` |
| `get_last_week_range()` | è¨ˆç®—ä¸Šé€±çš„é€±ä¸€åˆ°é€±æ—¥ | `(date(2025, 10, 28), date(2025, 11, 3))` |
| `format_number()` | æ ¼å¼åŒ–æ•¸å­— | `format_number(1234.56, decimals=0)` â†’ `"1,235"` |
| `format_percentage()` | æ ¼å¼åŒ–ç™¾åˆ†æ¯” | `format_percentage(5.01)` â†’ `"5.01%"` |
| `format_currency()` | æ ¼å¼åŒ–é‡‘é¡ | `format_currency(518919)` â†’ `"NT$ 518,919"` |

---

## ğŸš€ ä½¿ç”¨èªªæ˜

### åŸºæœ¬ä½¿ç”¨

```bash
# 1. é€²å…¥å°ˆæ¡ˆç›®éŒ„
cd weekly-report-generator

# 2. ç¢ºä¿å·²å®‰è£ä¾è³´
pip install -r requirements.txt

# 3. ç¢ºèª Google Cloud èªè­‰
gcloud auth application-default login

# 4. åŸ·è¡Œé€±å ±ç”Ÿæˆ
python src/main.py
```

### ç’°å¢ƒè®Šæ•¸è¨­å®šï¼ˆå¯é¸ï¼‰

å»ºç«‹ `.env` æª”æ¡ˆï¼š

```env
# å“ç‰Œåç¨±
BRAND_NAME=è±†æ²¹ä¼¯

# å ±å‘Šå¤©æ•¸ï¼ˆç›®å‰ä¸ä½¿ç”¨ï¼Œå›ºå®šç‚ºé€±ä¸€åˆ°é€±æ—¥ï¼‰
REPORT_DAYS=7

# Google Cloud å°ˆæ¡ˆï¼ˆå¯åœ¨ç¨‹å¼ç¢¼ä¸­è¨­å®šï¼‰
GOOGLE_CLOUD_PROJECT=datalake360-saintpaul
```

### æ¸¬è©¦è…³æœ¬

```bash
# æ¸¬è©¦ BigQuery é€£ç·š
python test_connection.py

# æ¸¬è©¦æ‰€æœ‰æŸ¥è©¢åŠŸèƒ½
python test_queries.py

# æª¢æŸ¥ transaction_id æ ¼å¼
python check_transaction_id_format.py

# æ¸¬è©¦ JOIN åŠŸèƒ½
python test_join_transaction_id.py
```

### è¼¸å‡ºçµæœ

ç”Ÿæˆçš„å ±å‘Šæœƒå„²å­˜åœ¨ `output/` ç›®éŒ„ï¼Œå¯ä»¥ç›´æ¥åœ¨ç€è¦½å™¨ä¸­é–‹å•ŸæŸ¥çœ‹ã€‚

---

## ğŸ” é—œéµé‚è¼¯èªªæ˜

### 1. æ™‚é–“ç¯„åœè¨ˆç®—

**é‡è¦**ï¼šé€±å ±ä½¿ç”¨ã€Œé€±ä¸€åˆ°é€±æ—¥ã€çš„æ¦‚å¿µï¼Œä¸æ˜¯ã€Œæœ€è¿‘ 7 å¤©ã€ã€‚

```python
from src.utils import get_week_range, get_last_week_range

# æœ¬é€±ç¯„åœï¼ˆé€±ä¸€åˆ°é€±æ—¥ï¼‰
monday, sunday = get_week_range()
# ä¾‹å¦‚ï¼šdate(2025, 11, 4) è‡³ date(2025, 11, 10)

# ä¸Šé€±ç¯„åœï¼ˆä¸Šé€±ä¸€åˆ°ä¸Šé€±æ—¥ï¼‰
last_monday, last_sunday = get_last_week_range()
# ä¾‹å¦‚ï¼šdate(2025, 10, 28) è‡³ date(2025, 11, 3)
```

### 2. æµé‡åˆ†æ JOIN é‚è¼¯

**ç‚ºä»€éº¼åˆ†å…©æ­¥æŸ¥è©¢ï¼Ÿ**

å› ç‚º GA4 äº‹ä»¶è¡¨ï¼ˆ`analytics_304437305.events_*`ï¼‰å’Œ Shopline è¨‚å–®è¡¨ï¼ˆ`datalake_stpl.lv1_order_master`ï¼‰å¯èƒ½åœ¨ä¸åŒä½ç½®ï¼Œç›´æ¥åœ¨ SQL ä¸­ JOIN æœƒå‡ºç¾ä½ç½®éŒ¯èª¤ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æ­¥é©Ÿ 1ï¼šæŸ¥è©¢ GA4 Sessionsï¼ˆæŒ‰æµé‡ä¾†æºåˆ†çµ„ï¼‰
2. æ­¥é©Ÿ 2ï¼šæŸ¥è©¢ GA4 Purchasesï¼ˆå–å¾— transaction_id å’Œæµé‡ä¾†æºï¼‰
3. æ­¥é©Ÿ 3ï¼šæŸ¥è©¢ Shopline è¨‚å–®ï¼ˆå–å¾— ord_id å’Œè¨‚å–®é‡‘é¡ï¼‰
4. æ­¥é©Ÿ 4ï¼šåœ¨ Python ä¸­ä½¿ç”¨ pandas `merge()` JOIN

```python
# åœ¨ Python ä¸­ JOIN
traffic_orders = purchases_df.merge(
    orders_df,
    left_on='transaction_id',
    right_on='ord_id',
    how='inner'
)
```

### 3. Transaction ID å°æ‡‰

**æ ¼å¼**ï¼š17 ä½æ•¸å­—ï¼ˆä¾‹å¦‚ï¼š`20241105153444114`ï¼‰

**çµæ§‹**ï¼š
- å‰ 8 ä½ï¼šæ—¥æœŸï¼ˆYYYYMMDDï¼‰
- ä¸­é–“ 6 ä½ï¼šæ™‚é–“ï¼ˆHHMMSSï¼‰
- å¾Œ 3 ä½ï¼šåºè™Ÿ

**é©—è­‰**ï¼šGA4 çš„ `transaction_id` å’Œ Shopline çš„ `ord_id` æ ¼å¼å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥ç›´æ¥ JOINã€‚

### 4. æµé‡ä¾†æºåˆ†é¡é‚è¼¯

**è³‡æ–™ä¾†æº**ï¼š
- **Sessions**ï¼šä½¿ç”¨ `traffic_source.source` å’Œ `traffic_source.medium`
- **Purchases**ï¼šä½¿ç”¨ `session_traffic_source_last_click.manual_campaign` æˆ– `cross_channel_campaign`

**åˆ†é¡ SQL**ï¼š
```sql
CASE
    WHEN source = '(direct)' AND (medium = '(none)' OR medium = '(not set)') THEN '1. ç›´æ¥æµé‡'
    WHEN REGEXP_CONTAINS(LOWER(CONCAT(source, ' / ', medium)), r'/ organic$|.*search.*') THEN '2. è‡ªç„¶æœå°‹'
    ...
END
```

### 5. æ•¸å­—æ ¼å¼åŒ–è¦å‰‡

| é¡å‹ | æ ¼å¼ | å‡½æ•¸ | ç¯„ä¾‹ |
|------|------|------|------|
| é‡‘é¡ | æ•´æ•¸ï¼Œåƒåˆ†ä½ | `format_currency()` | `NT$ 518,919` |
| ç™¾åˆ†æ¯” | å…©ä½å°æ•¸ | `format_percentage()` | `5.01%` |
| è¨‚å–®æ•¸ | æ•´æ•¸ï¼Œåƒåˆ†ä½ | `format_number()` | `238` |

---

## âš ï¸ å¸¸è¦‹å•é¡Œèˆ‡æ’éŒ¯

### 1. BigQuery é€£ç·šå¤±æ•—

**éŒ¯èª¤è¨Šæ¯**ï¼š
```
Your default credentials were not found.
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# è¨­å®š Application Default Credentials
gcloud auth application-default login

# è¨­å®š quota project
gcloud auth application-default set-quota-project datalake360-saintpaul
```

### 2. ä½ç½®éŒ¯èª¤ï¼ˆLocation Errorï¼‰

**éŒ¯èª¤è¨Šæ¯**ï¼š
```
404 Not found: Dataset datalake360-saintpaul:datalake_stpl was not found in location asia-east1
```

**åŸå› **ï¼šè³‡æ–™é›†å¯¦éš›ä½ç½®æ˜¯ `asia-northeast1`ï¼Œä½†æŸ¥è©¢æ™‚æŒ‡å®šäº†éŒ¯èª¤ä½ç½®ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- åœ¨ `bigquery_config.py` ä¸­ï¼Œä¸è¦æ˜ç¢ºæŒ‡å®š `location` åƒæ•¸
- è®“ BigQuery è‡ªå‹•åµæ¸¬è³‡æ–™é›†ä½ç½®

### 3. Transaction ID æ ¼å¼ä¸ä¸€è‡´

**ç—‡ç‹€**ï¼šæµé‡åˆ†ææ²’æœ‰è³‡æ–™ï¼ŒJOIN å¤±æ•—ã€‚

**æª¢æŸ¥æ–¹å¼**ï¼š
```bash
python check_transaction_id_format.py
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç¢ºèª GA4 çš„ `transaction_id` å’Œ Shopline çš„ `ord_id` æ ¼å¼ä¸€è‡´
- å¦‚æœæ ¼å¼ä¸åŒï¼Œéœ€è¦èª¿æ•´ JOIN é‚è¼¯

### 4. æµé‡åˆ†æé¡è‰²æ²’æœ‰å€åˆ†

**åŸå› **ï¼šPyEcharts çš„é¡è‰²é…ç½®æ²’æœ‰æ­£ç¢ºæ‡‰ç”¨ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æª¢æŸ¥ `chart_generator.py` ä¸­çš„ `color_map` é…ç½®
- ç¢ºèª `TRAFFIC_SOURCE_COLORS` åœ¨ `chart_config.py` ä¸­æ­£ç¢ºå®šç¾©

### 5. æ•¸å­—æ ¼å¼åŒ–éŒ¯èª¤

**ç—‡ç‹€**ï¼šç™¾åˆ†æ¯”é¡¯ç¤ºç‚ºå°æ•¸ï¼Œé‡‘é¡é¡¯ç¤ºç‚ºæµ®é»æ•¸ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `format_percentage()` æ ¼å¼åŒ–ç™¾åˆ†æ¯”ï¼ˆå…©ä½å°æ•¸ï¼‰
- ä½¿ç”¨ `format_currency()` æ ¼å¼åŒ–é‡‘é¡ï¼ˆæ•´æ•¸ï¼‰

### 6. æ—¥æœŸç¯„åœéŒ¯èª¤

**ç—‡ç‹€**ï¼šæŸ¥è©¢çš„è³‡æ–™ä¸æ˜¯é€±ä¸€åˆ°é€±æ—¥ã€‚

**æª¢æŸ¥æ–¹å¼**ï¼š
```python
from src.utils import get_week_range
monday, sunday = get_week_range()
print(f"æœ¬é€±ç¯„åœï¼š{monday} è‡³ {sunday}")
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç¢ºèªæ‰€æœ‰æŸ¥è©¢æ–¹æ³•éƒ½ä½¿ç”¨ `start_date` å’Œ `end_date` åƒæ•¸
- ä¸è¦ä½¿ç”¨ `days=7` åƒæ•¸ï¼ˆå·²æ£„ç”¨ï¼‰

---

## ğŸ“ å¾…è¾¦äº‹é …èˆ‡æœªä¾†è¦åŠƒ

### å·²å®Œæˆ

- [x] BigQuery é€£ç·šè¨­å®š
- [x] è³‡æ–™æŸ¥è©¢æ¨¡çµ„ï¼ˆGMVã€æµé‡åˆ†æã€AOVã€è½‰æ›æ¼æ–—ï¼‰
- [x] æµé‡åˆ†é¡é‚è¼¯ï¼ˆ8 ç¨®åˆ†é¡ï¼‰
- [x] PyEcharts åœ–è¡¨ç”Ÿæˆ
- [x] HTML å ±å‘Šæ¨¡æ¿
- [x] æ•¸å­—æ ¼å¼åŒ–ï¼ˆç™¾åˆ†æ¯”å…©ä½å°æ•¸ï¼Œé‡‘é¡å–æ•´æ•¸ï¼‰
- [x] æ™‚é–“ç¯„åœè¨ˆç®—ï¼ˆé€±ä¸€åˆ°é€±æ—¥ï¼‰
- [x] AI æ‘˜è¦ç”Ÿæˆï¼ˆè¦å‰‡å¼ï¼‰

### å¾…å®Œæˆ

#### é«˜å„ªå…ˆç´š

- [ ] **LLM æ•´åˆ**ï¼šå°‡ AI æ‘˜è¦å¾è¦å‰‡å¼æ”¹ç‚º LLM ç”Ÿæˆ
  - æ”¯æ´ OpenAI API
  - æ”¯æ´ Anthropic API
  - å¯è‡ªè¨‚ prompt
  - å¾Œå°åŸ·è¡Œï¼Œä¸å½±éŸ¿å‰å°æ•ˆèƒ½

- [ ] **æ–°å®¢/å›è³¼å®¢åˆ¤æ–·**ï¼šå¯¦ä½œé¦–æ¬¡è³¼è²·æ—¥æœŸçš„åˆ¤æ–·é‚è¼¯
  - JOIN `lv1_user` è¡¨
  - è¨ˆç®—é¦–æ¬¡è³¼è²·æ—¥æœŸ
  - å€åˆ†æ–°å®¢å’Œå›è³¼å®¢çš„ AOV åˆ†æ

- [ ] **éŒ¯èª¤è™•ç†åŠ å¼·**ï¼š
  - æ›´è©³ç´°çš„éŒ¯èª¤è¨Šæ¯
  - æ—¥èªŒè¨˜éŒ„
  - æŸ¥è©¢å¤±æ•—æ™‚çš„é™ç´šè™•ç†

#### ä¸­å„ªå…ˆç´š

- [ ] **æ•ˆèƒ½å„ªåŒ–**ï¼š
  - ä½¿ç”¨ BigQuery æ‰¹æ¬¡æŸ¥è©¢
  - å¿«å–æ©Ÿåˆ¶ï¼ˆé¿å…é‡è¤‡æŸ¥è©¢ï¼‰
  - ä¸¦è¡ŒæŸ¥è©¢

- [ ] **æ¸¬è©¦è¦†è“‹**ï¼š
  - å–®å…ƒæ¸¬è©¦
  - æ•´åˆæ¸¬è©¦
  - æŸ¥è©¢é‚è¼¯æ¸¬è©¦

- [ ] **é…ç½®ç®¡ç†**ï¼š
  - æ”¯æ´å¤šå“ç‰Œé…ç½®
  - ç’°å¢ƒè®Šæ•¸é©—è­‰
  - é…ç½®æª”æ¡ˆç¯„ä¾‹

#### ä½å„ªå…ˆç´š

- [ ] **å ±å‘Šå®¢è£½åŒ–**ï¼š
  - å¯é¸çš„åœ–è¡¨é¡å‹
  - è‡ªè¨‚é¡è‰²ä¸»é¡Œ
  - å¤šèªè¨€æ”¯æ´

- [ ] **æ’ç¨‹åŠŸèƒ½**ï¼š
  - è‡ªå‹•æ¯é€±ç”Ÿæˆå ±å‘Š
  - Email ç™¼é€
  - ä¸Šå‚³åˆ° Google Drive

---

## ğŸ“š ç›¸é—œæ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶

1. **README.md**ï¼šå°ˆæ¡ˆåŸºæœ¬èªªæ˜
2. **HANDOVER_DOCUMENT.md**ï¼šæœ¬äº¤æ¥æ–‡ä»¶ï¼ˆ**æœ€é‡è¦**ï¼‰
3. **AUTHENTICATION_SETUP.md**ï¼šGoogle Cloud èªè­‰è¨­å®šæŒ‡å—

### æŠ€è¡“æ–‡ä»¶

1. **DATABASE_SCHEMA.md**ï¼šè³‡æ–™åº«çµæ§‹èªªæ˜
2. **SQL_QUERY_UPDATE.md**ï¼šSQL æŸ¥è©¢é‚è¼¯æ›´æ–°è¨˜éŒ„
3. **TRAFFIC_CLASSIFICATION.md**ï¼šæµé‡åˆ†é¡è¦å‰‡è©³ç´°èªªæ˜
4. **TRAFFIC_ANALYSIS_IMPLEMENTATION.md**ï¼šæµé‡åˆ†æå¯¦ä½œèªªæ˜
5. **TRANSACTION_ID_VERIFICATION.md**ï¼šTransaction ID æ ¼å¼é©—è­‰çµæœ

### é…ç½®æ–‡ä»¶

1. **CONFIGURATION_SUMMARY.md**ï¼šBigQuery é…ç½®ç¸½çµ
2. **FINAL_SUMMARY.md**ï¼šå°ˆæ¡ˆå®Œæˆç¸½çµ

### æ¸¬è©¦è…³æœ¬

1. **test_connection.py**ï¼šæ¸¬è©¦ BigQuery é€£ç·š
2. **test_queries.py**ï¼šæ¸¬è©¦æ‰€æœ‰æŸ¥è©¢åŠŸèƒ½
3. **check_transaction_id_format.py**ï¼šæª¢æŸ¥ transaction_id æ ¼å¼
4. **test_join_transaction_id.py**ï¼šæ¸¬è©¦ JOIN åŠŸèƒ½

---

## ğŸ”‘ é—œéµè³‡è¨Šé€ŸæŸ¥

### å°ˆæ¡ˆè·¯å¾‘
```
/Users/winson/Dropbox/vibe_tools/ec-tools/weekly-report-generator
```

### BigQuery å°ˆæ¡ˆ
```
å°ˆæ¡ˆ ID: datalake360-saintpaul
è³‡æ–™é›†: datalake_stpl, analytics_304437305
```

### é—œéµæ¬„ä½
```
è¨‚å–®è¡¨: ord_rev (é‡‘é¡), bhv1 (ç‹€æ…‹), ord_id (è¨‚å–®ç·¨è™Ÿ)
GA4 è¡¨: transaction_id (17ä½æ•¸å­—), traffic_source (æµé‡ä¾†æº)
```

### æ™‚é–“è¨ˆç®—
```
é€±ä¸€åˆ°é€±æ—¥: get_week_range()
ä¸Šé€±ä¸€åˆ°ä¸Šé€±æ—¥: get_last_week_range()
```

### åŸ·è¡Œå‘½ä»¤
```bash
# ç”Ÿæˆé€±å ±
python src/main.py

# æ¸¬è©¦é€£ç·š
python test_connection.py

# æ¸¬è©¦æŸ¥è©¢
python test_queries.py
```

---

## ğŸ“ è¯çµ¡è³‡è¨Š

å¦‚æœ‰å•é¡Œï¼Œè«‹åƒè€ƒï¼š
1. ç›¸é—œæ–‡ä»¶ï¼ˆè¦‹ä¸Šæ–¹ï¼‰
2. æ¸¬è©¦è…³æœ¬ï¼ˆç”¨æ–¼è¨ºæ–·å•é¡Œï¼‰
3. ç¨‹å¼ç¢¼è¨»è§£ï¼ˆè©³ç´°èªªæ˜æ¯å€‹å‡½æ•¸ï¼‰

---

## ğŸ¯ å¿«é€Ÿé–‹å§‹æŒ‡å—

### ç¬¬ä¸€æ¬¡ä½¿ç”¨

1. **å®‰è£ä¾è³´**
   ```bash
   pip install -r requirements.txt
   ```

2. **è¨­å®šèªè­‰**
   ```bash
   gcloud auth application-default login
   gcloud auth application-default set-quota-project datalake360-saintpaul
   ```

3. **æ¸¬è©¦é€£ç·š**
   ```bash
   python test_connection.py
   ```

4. **ç”Ÿæˆé€±å ±**
   ```bash
   python src/main.py
   ```

5. **æŸ¥çœ‹å ±å‘Š**
   - é–‹å•Ÿ `output/` ç›®éŒ„ä¸­çš„ HTML æª”æ¡ˆ

### å¸¸è¦‹ä¿®æ”¹

**ä¿®æ”¹å“ç‰Œåç¨±**ï¼š
- ç·¨è¼¯ `.env` æª”æ¡ˆï¼š`BRAND_NAME=æ–°å“ç‰Œåç¨±`

**ä¿®æ”¹åœ–è¡¨é¡è‰²**ï¼š
- ç·¨è¼¯ `config/chart_config.py`ï¼šä¿®æ”¹ `TRAFFIC_SOURCE_COLORS`

**ä¿®æ”¹æŸ¥è©¢é‚è¼¯**ï¼š
- ç·¨è¼¯ `src/data_fetcher.py`ï¼šä¿®æ”¹å°æ‡‰çš„ SQL æŸ¥è©¢

**ä¿®æ”¹å ±å‘Šæ¨¡æ¿**ï¼š
- ç·¨è¼¯ `templates/report_template.html`ï¼šèª¿æ•´ HTML çµæ§‹

---

## ğŸ“Œ é‡è¦æé†’

1. **æ™‚é–“ç¯„åœ**ï¼šé€±å ±ä½¿ç”¨ã€Œé€±ä¸€åˆ°é€±æ—¥ã€ï¼Œä¸æ˜¯ã€Œæœ€è¿‘ 7 å¤©ã€
2. **æ¬„ä½åç¨±**ï¼šä½¿ç”¨ `ord_rev` ä¸æ˜¯ `ord_total`ï¼Œä½¿ç”¨ `bhv1` åˆ¤æ–·å–æ¶ˆ
3. **ä½ç½®å•é¡Œ**ï¼šGA4 å’Œ Shopline è¡¨åœ¨ä¸åŒä½ç½®ï¼Œéœ€è¦åˆ†æ­¥æŸ¥è©¢
4. **æ•¸å­—æ ¼å¼**ï¼šç™¾åˆ†æ¯”å…©ä½å°æ•¸ï¼Œé‡‘é¡å–æ•´æ•¸
5. **Transaction ID**ï¼šæ ¼å¼ç‚º 17 ä½æ•¸å­—ï¼Œå¯ä»¥ç›´æ¥ JOIN

---

**æ–‡ä»¶ç¶­è­·**ï¼šè«‹å®šæœŸæ›´æ–°æ­¤æ–‡ä»¶ï¼Œç‰¹åˆ¥æ˜¯ç•¶æœ‰é‡å¤§è®Šæ›´æ™‚ã€‚

**æœ€å¾Œæ›´æ–°**ï¼š2025-11-05

