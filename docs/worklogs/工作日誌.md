## 工作日誌觸發條件

- 當主要課題、里程碑或截稿 deliverable 完成時立即記錄成果與後續待辦。
- 當專案遇到阻塞、異常或需要跨團隊協調時，紀錄情境、影響與處理決議。
- 當有重要決策、流程調整或技術選型變更時，於當日補寫摘要與依據。

## 2025-11-07 工作日誌

- **06:00-08:45** － 日報排程檢查與 GA4 驗證調整
  - 調整 GA4 驗證改讀取 `datalake_looker.daily_metrics`。
  - 增加 GA4 warning 顯示於 Google Chat 卡片。
  - 排程時間改為 09:30。

- **09:50-10:30** － Prototype GitHub Pages 404 問題處理
  - 確認 `/prototype` 移至 `demos/prototype`。
  - 建立轉址頁面。

- **11:00** － 週報專案盤點
  - 查看 `demos/weekly-report-generator` 狀況，準備後續任務。


- **12:30-16:30** － Weekly Report Spec Kit 導入與需求對齊
  - 依 `/speckit.specify`、`/speckit.plan`、`/speckit.tasks` 建立 `specs/weekly-report-enhancement/`，完成中文規格、技術計畫與任務清單。
  - 調整任務：LINE Notify 研究提前至 Phase 2 作為阻塞任務；MVP 以 LINE 推播 + Email 備援為主，Google Chat 限 SIT/UAT。
  - 補充 spec：多品牌初期以聖保羅/勤億雙品牌、備份派發紀錄、SLA 告警、LINE API 待研究等重點。
- **16:30-17:30** － LINE 推播 PoC
  - 建立 Zeabur webhook 服務 `https://webhook-reddoor.zeabur.app/webhook/line` 並驗證事件可寫入 log。
  - 重新產生 LINE channel access token，放入 `config/secrets.env`。
  - 使用 `line_notify_poc.py` 成功推播訊息給測試 userId（週報推播測試訊息）。


## 2025-11-11 工作日誌

- **10:30-11:10** － 日報 MTD 查詢修正
  - 發現 Looker Studio view 中 `SUM(total_revenue)` 會造成累加重複，改採單日查 `mtd_revenue`。
  - `fetch_mtd_metrics` 更新為直接過濾 `date = report_date`，避免跨日聚合。
  - SQL 片段：
    ```sql
    SELECT
      mtd_revenue,
      mtd_total_revenue
    FROM `datalake360-saintpaul.datalake_looker.daily_metrics`
    WHERE date = DATE(@report_date)
    LIMIT 1;
    ```
  - 重新執行 `python main.py --client client_A --date 2025-11-10 --dry-run`，確認 `mtd_revenue = 530435`、目標達成率同步修正。

